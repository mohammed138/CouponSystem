
@{
    ViewData["Title"] = "User List";
}


<div class="text-center my-10">
    <h1 class="mb-4 text-3xl font-extrabold leading-none tracking-tight text-gray-900 md:text-3xl lg:text-6xl ">
        This page displays all users in the system and allowed actions.
    </h1>
</div>

<div id="Create" class="my-5 flex justify-start">
    <a href="javascript:void(0);" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-300" onclick="createUser()">
        <i class="fas fa-plus-circle mr-2"></i> Add new User
    </a>
</div>

<div id="userTableContainer">
</div>

 
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
    function getAllUsers() {
        $.ajax({
            url: '/Users/GetAll',
            type: 'GET',
            success: function (result) {
                if (result.isSuccess) {
                    let tableContent = '';
                    result.data.$values.forEach(function (user) {
                        tableContent += `
                                <tr class="hover:bg-gray-50 transition duration-300" style="height:50px">
                                    <td class="border border-gray-300 px-4 py-2 text-gray-800">${user.emailAddress}</td>
                                    <td class="border border-gray-300 px-4 py-2 text-gray-800">${user.fullName}</td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <a href="javascript:void(0);" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-300" onclick="showDetails('${user.id}')">
                                            <i class="fas fa-eye mr-2"></i> Show Details
                                        </a>
                                        |
                                        <a href="javascript:void(0);" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-300" onclick="editUser('${user.id}')">
                                            <i class="fas fa-edit mr-2"></i> Edit
                                        </a>
                                        |
                                        <a href="javascript:void(0);" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-300" onclick="deleteUser('${user.id}')">
                                            <i class="fas fa-trash-alt mr-2"></i> Delete
                                        </a>
                                    </td>
                                </tr>
                            `;
                    });
                    $('#userTableContainer').html(`
                            <table class="w-full table-auto">
                                <thead>
                                    <tr class="bg-gray-100">
                                        <th class="border border-gray-300 px-4 py-2 text-gray-600 font-semibold text-left">Email</th>
                                        <th class="border border-gray-300 px-4 py-2 text-gray-600 font-semibold text-left">Full Name</th>
                                        <th class="border border-gray-300 px-4 py-2 text-gray-600 font-semibold text-left">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${tableContent}
                                </tbody>
                            </table>
                        `);
                } else {
                    alert(result.message);
                }
            },
            error: function () {
                alert('An error occurred while fetching users.');
            }
        });
    }
    function showDetails(id) {
        $.ajax({
            url: '/Users/GetDetails/' + id,
            type: 'GET',
            success: function (result) {
                let modalContent = `
                                                <p> fullName: ${result.data.fullName}</p>
                                                <p>emailAddress: ${result.data.emailAddress}</p>
                            `;
                $('#modelModal .modal-body').html(modalContent);
                $('#modelModal').removeClass('hidden');


            },
            error: function () {
                alert('An error occurred while fetching product details.');
            }
        });
    }
    function editUser(id) {
        $.ajax({
            url: '/Users/Edit/' + id,
            type: 'GET',
            success: function (result) {
                $('#modelModal .modal-body').html(result);
                $('#modelModal').removeClass('hidden');
            },
            error: function () {
                alert('An error occurred while fetching user edit form.');
            }
        });
    }
    function deleteUser(id) {
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: '/Users/Delete/' + id,
                    type: 'POST',
                    success: function () {
                        Swal.fire('Deleted!', 'User has been deleted.', 'success');
                        location.reload();
                    },
                    error: function () {
                        alert('An error occurred while deleting the user.');
                    }
                });
            }
        });
    }
    function createUser() {
        $.ajax({
            url: '/Users/Create',
            type: 'GET',
            success: function (result) {
                $('#modelModal .modal-body').html(result);
                $('#modelModal').removeClass('hidden');
            },
            error: function () {
                alert('An error occurred while loading the create user form.');
            }
        });
    }

    $(document).ready(function () {
        getAllUsers();
    });
</script>
